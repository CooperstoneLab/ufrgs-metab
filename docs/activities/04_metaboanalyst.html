<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jessica Cooperstone">

<title>Data analysis with MetaboAnalyst</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../img/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href="../lectures/01_intro.html" rel="" target="">
 <span class="dropdown-text">Introduction to metabolomics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/02_design-collection.html" rel="" target="">
 <span class="dropdown-text">Study design and sample collection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/03_lc-ms.html" rel="" target="">
 <span class="dropdown-text">LC-MS data acquisition and pre-processing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/04_data-analysis.html" rel="" target="">
 <span class="dropdown-text">Data analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../lectures/05_compound-id.html" rel="" target="">
 <span class="dropdown-text">Compound ID</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-activities" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Activities</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-activities">    
        <li>
    <a class="dropdown-item" href="../activities/02_design-experiment.html" rel="" target="">
 <span class="dropdown-text">Design your own experiment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/03_mzmine.html" rel="" target="">
 <span class="dropdown-text">LC-MS pre-processing with MZmine</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/04_metaboanalyst.html" rel="" target="">
 <span class="dropdown-text">Data analysis with MetaboAnalyst</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../activities/05_R.html" rel="" target="">
 <span class="dropdown-text">Data analysis with R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="https://mzio.io/" rel="" target="">
 <span class="dropdown-text">MZmine</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.metaboanalyst.ca/" rel="" target="">
 <span class="dropdown-text">MetaboAnalyst</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hmdb.ca/" rel="" target="">
 <span class="dropdown-text">HMDB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="http://ondemand.osc.edu/" rel="" target="">
 <span class="dropdown-text">Ohio Supercomputer Center (OSC)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://cooperstonelab.github.io/ufrgs-metab/activities/03_mzmine.html#using-mzmine-at-osc-ohio-supercomputer-center" rel="" target="">
 <span class="dropdown-text">Getting started with OSC</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://buckeyemailosu-my.sharepoint.com/:f:/g/personal/cooperstone_1_osu_edu/Em__DQbIlCBBuadrLMNDr8gB7-_tQayjX1JSzSdubjwhQA?e=QZdzx4" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-cloud-arrow-down"></i></a>
    <a href="https://github.com/CooperstoneLab/ufrgs-metab" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#data-formatting" id="toc-data-formatting" class="nav-link" data-scroll-target="#data-formatting"><span class="header-section-number">1.1</span> Data formatting</a></li>
  </ul></li>
  <li><a href="#import-into-metaboanalyst" id="toc-import-into-metaboanalyst" class="nav-link" data-scroll-target="#import-into-metaboanalyst"><span class="header-section-number">2</span> Import into MetaboAnalyst</a></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing"><span class="header-section-number">3</span> Data processing</a>
  <ul class="collapse">
  <li><a href="#data-check" id="toc-data-check" class="nav-link" data-scroll-target="#data-check"><span class="header-section-number">3.1</span> Data check</a></li>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values"><span class="header-section-number">3.2</span> Missing values</a></li>
  <li><a href="#data-filters" id="toc-data-filters" class="nav-link" data-scroll-target="#data-filters"><span class="header-section-number">3.3</span> Data filters</a></li>
  </ul></li>
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization"><span class="header-section-number">4</span> Normalization</a></li>
  <li><a href="#statistics" id="toc-statistics" class="nav-link" data-scroll-target="#statistics"><span class="header-section-number">5</span> Statistics</a>
  <ul class="collapse">
  <li><a href="#pca-with-our-qcs" id="toc-pca-with-our-qcs" class="nav-link" data-scroll-target="#pca-with-our-qcs"><span class="header-section-number">5.1</span> PCA with our QCs</a></li>
  <li><a href="#pca-without-qcs" id="toc-pca-without-qcs" class="nav-link" data-scroll-target="#pca-without-qcs"><span class="header-section-number">5.2</span> PCA without QCs</a></li>
  <li><a href="#anova" id="toc-anova" class="nav-link" data-scroll-target="#anova"><span class="header-section-number">5.3</span> ANOVA</a></li>
  <li><a href="#dendrogram-i.e.-hierarchical-clustering" id="toc-dendrogram-i.e.-hierarchical-clustering" class="nav-link" data-scroll-target="#dendrogram-i.e.-hierarchical-clustering"><span class="header-section-number">5.4</span> Dendrogram (i.e., hierarchical clustering)</a></li>
  <li><a href="#k-means-a-different-type-of-clustering" id="toc-k-means-a-different-type-of-clustering" class="nav-link" data-scroll-target="#k-means-a-different-type-of-clustering"><span class="header-section-number">5.5</span> K-means (a different type of clustering)</a></li>
  <li><a href="#heatmaps" id="toc-heatmaps" class="nav-link" data-scroll-target="#heatmaps"><span class="header-section-number">5.6</span> Heatmaps</a></li>
  <li><a href="#correlations" id="toc-correlations" class="nav-link" data-scroll-target="#correlations"><span class="header-section-number">5.7</span> Correlations</a></li>
  <li><a href="#pls-da" id="toc-pls-da" class="nav-link" data-scroll-target="#pls-da"><span class="header-section-number">5.8</span> PLS-DA</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="header-section-number">5.9</span> Random forest</a></li>
  <li><a href="#pattern-hunter" id="toc-pattern-hunter" class="nav-link" data-scroll-target="#pattern-hunter"><span class="header-section-number">5.10</span> Pattern hunter</a></li>
  <li><a href="#fold-change-analysis" id="toc-fold-change-analysis" class="nav-link" data-scroll-target="#fold-change-analysis"><span class="header-section-number">5.11</span> Fold change analysis</a></li>
  <li><a href="#t-test" id="toc-t-test" class="nav-link" data-scroll-target="#t-test"><span class="header-section-number">5.12</span> T-test</a></li>
  <li><a href="#volcano-plots" id="toc-volcano-plots" class="nav-link" data-scroll-target="#volcano-plots"><span class="header-section-number">5.13</span> Volcano plots</a></li>
  </ul></li>
  <li><a href="#concluding-thoughts" id="toc-concluding-thoughts" class="nav-link" data-scroll-target="#concluding-thoughts"><span class="header-section-number">6</span> Concluding thoughts</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">7</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data analysis with MetaboAnalyst</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jessica Cooperstone </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Now that we have a filtered, final feature table, we can get started on our data analysis, including understanding if our data is of good quality before we begin to make biological interpretations as to what our results mean. We are going to conduct this analysis using <a href="https://www.metaboanalyst.ca/">MetaboAnalyst</a> which is at version 6.0 when I put together this tutorial. You can read more about MetaboAnalyist on their website or in their publications <span class="citation" data-cites="ewald2024">(<a href="#ref-ewald2024" role="doc-biblioref">Ewald et al. 2024</a>)</span>.</p>
<section id="data-formatting" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="data-formatting"><span class="header-section-number">1.1</span> Data formatting</h2>
<p>Before we upload our data, let’s make sure its in a suitable format. If we go to the <a href="https://www.metaboanalyst.ca/docs/Format.xhtml">Data Formats link</a> on the left side of the website, we can see example data sets which will help us format our data. Our data looks like this right out of MZmine:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/raw.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Our data, straight from MZmine</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Our data contains samples in rows, and features in columns.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>We will start with doing statistics (one factor) and we have a peak intensity table, so the file called <a href="https://www.xialab.ca/api/download/metaboanalyst/lcms_table.csv"><code>lcms_table.csv</code></a> is a good one for us to look at.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/lc-ms-table.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">LCMS sample data</figcaption>
</figure>
</div>
<p>In this data, we have features in rows and samples in columns. There is also a header row which contains the unique sample names, and a second row called Label which contains the groups. We will need to adjust our data to look like this. This includes</p>
<ul>
<li>Adding a row called Label which contains the sample groups (here, QC, HATS, LA2213, or OH8243).</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/add-label.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Add a row which contains Label and the tomato identities</figcaption>
</figure>
</div>
<ul>
<li>Creating a single column with the mz_rt as a unique identifier. We can do this with the function <code>=CONCATENATE()</code> in Excel. Then we can fill down the row. Then be sure to copy this column and <code>Paste</code> &gt; <code>Paste special</code> &gt; <code>Values</code> since when we later remove some of the other columns that are inputs to this one, the formulas will break.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/add-mz_rt.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">How to combine the row m/z and row retention time columns to be one unique mz_rt</figcaption>
</figure>
</div>
<ul>
<li>Now we can remove row ID, row m/z and row retention time.</li>
</ul>
<p>Our data should now look like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/data-for-metaboanalyst.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Our data ready to import into MetaboAnalyst</figcaption>
</figure>
</div>
</section>
</section>
<section id="import-into-metaboanalyst" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Import into MetaboAnalyst</h1>
<p>Remember that when you are using MetaboAnalyst through the web browser that it will eventually time out, so starting an analysis, and walking away for a period of time is not a good idea. Make sure you keep good notes on what you do during your analysis.</p>
<p>Navigate to <a href="https://www.metaboanalyst.ca/" class="uri">https://www.metaboanalyst.ca/</a> and click on the red “Click here to start button”.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/metaboanalyst-start.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Get started in MetaboAnalyst</figcaption>
</figure>
</div>
<p>We have already processed out spectra so we are going to click on Statistical Analysis (one factor).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/statistical-analysis.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Begin statistical analysis in MetaboAnalyst</figcaption>
</figure>
</div>
<p>Now we want to upload our data. We have our file saved as a .csv and our data is as peak intensities. In our case, samples are in columns and data is unpaired. Once we have done this, we can press submit just to the right of our input.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/upload.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Upload our data</figcaption>
</figure>
</div>
</section>
<section id="data-processing" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data processing</h1>
<section id="data-check" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="data-check"><span class="header-section-number">3.1</span> Data check</h2>
<p>Once the data has been imported, we can first look at the data integrity check.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/integrity-check.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Data integrity check</figcaption>
</figure>
</div>
<p>We see that:</p>
<ul>
<li>Samples are in columns and features in rows</li>
<li>Our data is in <code>.csv</code> format</li>
<li>We have 42 samples and 2514 peaks - this is what we would expect</li>
<li>Samples are not paired - this is what we would expect</li>
<li>3 groups were dtected - I might expect 4 groups - OH8243, LA2213, HATS, and QCs. If we click the “Edit Groups” button we can see that the Label for each of our groups has inherited correctly, but that it seems like QC isn’t being counted as a group.</li>
<li>A total of 0 (0%) missing values were detected - this makes sense as data that is missing here is coded as zero.</li>
</ul>
<p>If we agree with this, we can click Proceed. MetaboAnalyst will bring you directly to the Data filtering step, but we can go back one to see how missing values are handled.</p>
</section>
<section id="missing-values" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="missing-values"><span class="header-section-number">3.2</span> Missing values</h2>
<p>Here you can tell MetaboAnalyst what you want done with missing values. Here we don’t have any (our missing values are coded as zero), but if you did you could indicate:</p>
<ul>
<li>Whether you want to remove features that have a lot of missing values</li>
<li>What you want to do to estimate the remaining missing values.</li>
</ul>
</section>
<section id="data-filters" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="data-filters"><span class="header-section-number">3.3</span> Data filters</h2>
<p>In this step, we can filter variables based on different rules. These include:</p>
<ul>
<li>Features that are very variable in the QCs. We don’t need to do this because we already did it manually.</li>
<li>Features that are near constant across the conditions (i.e., those that have very low standard deviations)</li>
<li>Features that are very low</li>
</ul>
<p>I prefer to do this kind of filtering outside of MetaboAnalyst - you could do this in Excel if you wanted to. Here, we are not going to do any more filtering. We can just click Proceed (and skip this filtering).</p>
</section>
</section>
<section id="normalization" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Normalization</h1>
<p>We can normalize our samples in different ways. MetaboAnalyst gives is 3 categories of transformation types:</p>
<ul>
<li>Sample normalization for general adjustment for systemic differences across samples. Here would could adjust by weight, by a reference features, or by total signal.</li>
<li>Data transformation including by log (base 10), square root, or cubed room</li>
<li>Data scaling</li>
</ul>
<p>You can pick a normalization and view the result. This is nice because you can see what your normalization will do before picking the most appropriate one.</p>
<p>For example, I am going to try just log10 transforming my samples. When I do this, I can look at the result from both a feature and sample view.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Feature view</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Sample view</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/log10-feature-view.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Feature view after log10 normalization</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/log10-sample-view.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Sample view after log10 normalization</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>I can contrast this with a log10 transformation and then Pareto scaling.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Feature view</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Sample view</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/log10-pareto-feature-view.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Feature view after log10 normalization</figcaption>
</figure>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/log10-pareto-sample-view.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Sample view after log10 normalization</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>I think these look pretty similar and I think it would be ok to use either transformation. I am going to continue the rest of the analysis with just the log10 transformed data.</p>
</section>
<section id="statistics" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Statistics</h1>
<p>Now that our data is set, we can use different analysis methods to understand our data quality, and differences among sample groups. Remember, there are analyses we want to do both with and without the QCs. I like to see a PCA that includes the QCs, but then I’d remove them and retain our three tomato groups for further analysis.</p>
<p>Let’s look with our QCs at the PCA first, and then we will remove those samples.</p>
<section id="pca-with-our-qcs" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="pca-with-our-qcs"><span class="header-section-number">5.1</span> PCA with our QCs</h2>
<p>When we look at the PCA tab, we can see:</p>
<ul>
<li>An overview - which includes PCA scores plot for each combination of PCs 1 through 5. The most conventional one to look at would be PC1 vs PC2.</li>
<li>A scree plot - this shows us how much variation is explained by each of the PCs</li>
<li>A 2D scores plot - this shows us each sample’s new coordinates in a reduced dimensionality space. We can indicate what PC should be on which axis (though again it’s hard for me to think of a reason to do something different from PC1 on x and PC2 on y)</li>
<li>A loadings plot - this shows us how the variables (here, features) are weighted in contributing to each PC</li>
<li>3D plots - I find these to be terrible and never use them</li>
<li>A biplot - combines the scores and the loadings, and can get very overplotted for MS metabolomics data.</li>
</ul>
<p>Let’s look at each plot, talk about what it shows us, and try to interpret the data in the context of this particular experiment.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pca-qcs-scores-5PC.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A 5 component PCA scores plot</figcaption>
</figure>
</div>
<p>In the PCA overview, we can see a big chunk of variation (63%) is explained on PC1. We also see that our groups are really clearly separated when viewing PC1 vs.&nbsp;PC2.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pca-qc-scree.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A scree plot</figcaption>
</figure>
</div>
<p>When looking at the scree plot, we again see a large percentage of variation explained by PC1, and less variation explained by each subsequent PC. This is going to always be the case - PC2 always explains more variation than PC3, and PC3 more than PC4. But we can interpret this to be that drawing two PCs explains 78.4% of the metabolic variation in our dataset, and that adding additional PCs doesn’t explain all that much additional variation.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pca-qc-scores.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A scores plot including our QCs</figcaption>
</figure>
</div>
<p>When we think of PCAs, what we are typically thinking of is a scores plot. In this one, we see a few important things:</p>
<ul>
<li>Our QCs are clustering very closely together - this is a good piece of data to convince both ourselves and our readers that our data is of high quality. We are able to measure the same thing very reproducibly.</li>
<li>PC1 mostly separates LA2213 (the wild tomato) from OH8243 and HATS (the cultivated tomatoes).</li>
<li>PC2 mostly separates OH8243 (the commercial parent) from HATS (the tomato that has been introgressed for the trait of high steroidal alkaloids).</li>
<li>Overall, HATS and OH8243 are more similar than either of those two are to LA2213.</li>
</ul>
<p>You can adjust in MetaboAnalyst how this plot looks. I tend to turn sample names and confidence intervals off because I think they crowd the plot. You can click on the little paint palette to be able to specify how your plot looks (change colors and shapes) and download a high quality image.</p>
<p>I would always put a figure like this in the supplementary materials of my papers so readers can get confidence that our data is worth spending time interpreting.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pca-qc-loadings.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A PCA loadings plot, and in this case a big mess</figcaption>
</figure>
</div>
<p>The loadings plot helps us to interpret that is driving separation on PC1 and PC2. Interpreting this alongside our scores plot, in this case, points on the far right of the plot should be higher in LA2213 and points on the far left should be higher oh OH8243 and HATS. Points that are close to the top of the plot should be higher in HATS and those towards the bottom higher in OH8243 or LA2213.</p>
<p>For example, if we click on the right most point on the loadings plot, we can see that this represents the feature with the identifier 578.5296_5.0895. We can select a boxplot and see the relative intensity of this feature across our sample groups.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/578.5296215_5.0895395_qc.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Group relative intensities of 578.5296_5.0895</figcaption>
</figure>
</div>
<p>Similarly, the point with the highest value on the y axis 474.3578_6.5878 is highest in HATS and lower in the other tomatoes.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/474.3577933_6.587835_qc.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Group relative intensities of 474.3578_6.5878</figcaption>
</figure>
</div>
<p>You can also download the raw data for your loadings. This might be helpful to see which features have the highest and lowest values on loadings 1 and 2. You can also view boxplots of the feature abundances in this same view and sort your loadings.</p>
</section>
<section id="pca-without-qcs" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="pca-without-qcs"><span class="header-section-number">5.2</span> PCA without QCs</h2>
<p>That that we can see that our QCs are tightly clustering together, we can save that PCA scores plot and remove our QC samples. We can do that by navigating to <code>Processing</code> &gt; <code>Data editor</code> in the left part of the browser.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/data-editor.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Removing the QCs from our data</figcaption>
</figure>
</div>
<p>Don’t forget to re-normalize.</p>
<p>This dataset (without the QCs) is what I would use for the rest of this analysis.</p>
<p>Here is a PCA that could be used as a figure in a paper.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pca-noqc-scores.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">PCA scores plot without the QCs</figcaption>
</figure>
</div>
<p>We see the message of this PCA looks basically the same as when we had our QCs. But, we wouldn’t want to progress to univariate or multivariate statistics including our QCs as a group, since it is not an experimental group per se. I’m not going to go through all the plots again since we just did that with the QCs and the message is not changing.</p>
</section>
<section id="anova" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="anova"><span class="header-section-number">5.3</span> ANOVA</h2>
<p>We might be interested to see which features are significantly different across the 3 tomato groups, and we can assess that using ANOVA. We can set what our FDR cut-off should be, and I am going to be a little bit more stringent here and set this to 0.01.</p>
<p>In this case, this step isn’t that helpful since 2168 out of 2514 features are significantly different between at least two of our tomato groups. That doesn’t help us narrow down much of anything.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/aov_0.01.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">ANOVA visualization of features significantly different across tomato groups</figcaption>
</figure>
</div>
</section>
<section id="dendrogram-i.e.-hierarchical-clustering" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="dendrogram-i.e.-hierarchical-clustering"><span class="header-section-number">5.4</span> Dendrogram (i.e., hierarchical clustering)</h2>
<p>Hierarchical clustering is a nice unsupervised way to see how the metabolomic profile of your samples compare. Many people when talking about their PCA scores plot refer to “natural clusters” in their data. The problem with this is that PCA is not a clustering algorithm. If you want to show heuristically natural clusters in your data, hierarchical clustering can help</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/dendrogram_euclidean_ward.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Hierarchical clustering of samples</figcaption>
</figure>
</div>
<p>Here we can see a dendrogram (like a phylogenetic tree) which clusters samples based on a distance metric and clustering algorithm. Samples that are more similar should be close to one another, and the longer the distance is on the x-axis, the less similar samples are.</p>
<p>In this particular case, we can see 3 clusters derived of our 3 tomato groups. We can also see that HATS and OH8243 are more closely clustered compared to LA2213. This is consistent with what we see in our PCA.</p>
</section>
<section id="k-means-a-different-type-of-clustering" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="k-means-a-different-type-of-clustering"><span class="header-section-number">5.5</span> K-means (a different type of clustering)</h2>
<p>K-means is another unsupervised clustering technique that has a similarly interpreted output to HCA but with different underlying assumptions and math. Here, we have to provide how much clusters we have (you can learn more about how to figure this out <a href="https://cooperstonelab.github.io/ufrgs-metab/activities/05_R.html#k-means-clustering">here</a>. I am going to pick 3 because we have 3 tomato groups, and want to know if our samples will segregate based on group identity across 3 clusters.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/km_3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">K-means clustering with 3 clusters</figcaption>
</figure>
</div>
<p>Here, we can see that when we indicate 3 clusters, the tomato groups separate perfectly. This gives us some additional support that we have 3 distinct clusters in our data, and those are our tomato groups.</p>
<p>Alternatively, if we look for 2 or 4 clusters, we will see something different.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/km_2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">K-means clustering with 2 clusters</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/km_4.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">K-means clustering with 4 clusters</figcaption>
</figure>
</div>
<p>This looks to me actually like 3 clusters, but it’s not. If we click the spreadsheet beside the artists palette, we can see which samples belong to which cluster.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/km_4_cluster_id.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">K-means cluster identities with 4 clusters</figcaption>
</figure>
</div>
</section>
<section id="heatmaps" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="heatmaps"><span class="header-section-number">5.6</span> Heatmaps</h2>
<p>A heatmap is a nice way to look at lots of data at once. It doesn’t give you lots of resolution but allows you to see trends in your data you can then investigate in other ways.</p>
<p>When you create the heatmap, you can elect to:</p>
<ul>
<li>Data source: use normalized or the original data - I’d use normalized</li>
<li>Standardization: I would autoscale features - this way each feature is normalized so more abundant ones aren’t weighted more heavily</li>
<li>Distance measure and clustering method: these are for the hierarchical clustering</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/heatmap.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A heatmap where both smaples and features are clustered</figcaption>
</figure>
</div>
<p>As we saw with the HCA, our samples are clustering by which tomato group they are a part of. But here we can see which features have the same trends and this can be useful to us!</p>
</section>
<section id="correlations" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="correlations"><span class="header-section-number">5.7</span> Correlations</h2>
<p>The correlations analysis calculates a correlation coefficient between every pair of features. This plot is really crowed and hard to look at, but the concept is useful. We might be interested to know which groups of features have the same pattern of response across our samples. Or to know which features are highly negatively correlated.</p>
<p>I find this format hard to sort through, but this approach to be generally useful.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/correlation_table.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A correlation heatmap clustering both features and samples</figcaption>
</figure>
</div>
</section>
<section id="pls-da" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="pls-da"><span class="header-section-number">5.8</span> PLS-DA</h2>
<p>We can also take a supervised approach using PLS-DA. PLS-DA is most often used as a classification algorithm (i.e., can we develop a model based on a testing set that tells us whether a sample is a member of one group or another, and works for samples not a part of that test set), though it can also be used as a feature selection tool.</p>
<p>Using MetaboAnalyst, we can see:</p>
<ul>
<li>A overview of scores plots using the first 5 PCs</li>
<li>A 2D scores plot</li>
<li>Loadings plots</li>
<li>Important features</li>
<li>3D plots</li>
<li>Cross validation</li>
</ul>
<p>Remember that PLS-DA is trying to <strong>maximize difference between groups</strong> while PCA is trying to <strong>maximize variation across the dataset</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pls-scores.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">PLS-DA scores plot</figcaption>
</figure>
</div>
<p>We can look at which features are most contributing to separation between our groups, and MetaboAnalyst will plot these for you, or you can download a spreadsheet that contains every feature along with its score.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pls-vip.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Variable importance in project scores for the top 15 features</figcaption>
</figure>
</div>
<p>If you are doing PLS-DA, it is important to make sure your model can be validated and you are not overfitting (i.e., fitting noise). This is a particular problem especially in the metabolomics situation where you have orders of magnitude fewer samples than you do features.</p>
<p>In this case, by using only 2 PCs, we have very good cross validation accuracy (Q^2). You can adjust how many PCs you use and see how this affects your validation parameters.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pls-cv.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">PLS-DA cross validation</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p>The message at the bottom of the screen is an important one: “Q2 is an estimate of the predictive ability of the model, and is calculated via cross-validation (CV). In each CV, the predicted data are compared with the original data, and the sum of squared errors is calculated. The prediction error is then summed over all samples (Predicted Residual Sum of Squares or PRESS). For convenience, the PRESS is divided by the initial sum of squares and subtracted from 1 to resemble the scale of the R2. Good predictions will have low PRESS or high Q2. It is possible to have negative Q2, which means that your model is not at all predictive or is overfitted. For more details, refer to an excellent paper by (Szymańska, et al).”</p>
</blockquote>
<p>Keep in mind too that if you have an overfit model, your features that have high VIP scores may not be meaningful.</p>
</section>
<section id="random-forest" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">5.9</span> Random forest</h2>
<p>This isn’t that good of an example for random forest classification since our samples are so different.</p>
<p>Random forest is a machine learning class predition approach. In MetaboAnalyst, you can pick how many trees to draw and how many predictors to use.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/random-forest-classification.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Output of random forest classification</figcaption>
</figure>
</div>
<p>In this case, we can see that our out of bag error rate is 0, and with using very few trees, we are able to perfectly classify samples as to whether they belong to each of the three tomato groups.</p>
<p>If you look under the variable importance tab you can see the features that are most important in generating this model. You can look at this as a figure, or you can download a file to see how each one affects the mean decrease in accuracy. You can sort this list from high to low or low to high.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/random-forest-vip.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Variable importance predictors to our random forest model</figcaption>
</figure>
</div>
<p>You can then look for each of those figures how the relative intensity compares between tomato groups.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/1035.29429_5.111745_random-forest.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Intensity of 1035.29429_5.1117 across our three tomato groups</figcaption>
</figure>
</div>
<p>Another option for random forest is to have a training and a test set. As far as I can tell, MetaboAnalyst does this by calculating the out of bag error but there are also other approaches.</p>
</section>
<section id="pattern-hunter" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="pattern-hunter"><span class="header-section-number">5.10</span> Pattern hunter</h2>
<p>You might be interested in features that follow a certain pattern across your samples. Say you have samples that are processed for different amounts of time, you may be interested in knowing which features follow that trend (i.e., are lower or higher across processing). The pattern hunter helps us find features like this.</p>
<p>In this case, I am interested in features that follow this trend: OH8243 &lt; HATS &lt; LA2213.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/pattern-hunter.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Looking for patterns - here features that are highest in LA2213, second highest in HATS, and lowest in OH8243.</figcaption>
</figure>
</div>
<p>You can also click on the spreadsheet to see the correlation among each feature, and then view what the relationship looks like.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/1081.564533_4.6453156.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Relative intensity of 1081.56453_4.64531 across tomato groups</figcaption>
</figure>
</div>
</section>
<section id="fold-change-analysis" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="fold-change-analysis"><span class="header-section-number">5.11</span> Fold change analysis</h2>
<p>There are some analyses that can be only done with two groups (versus the three that we’ve had for the previous analyses). To demonstrate how these work, I am going to only keep the samples that are a part of the HATS and OH8243 groups.</p>
<p>I can edit that using the Data editor on the leftside panel.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/data-editor-2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Data editor to remove samples or gorups</figcaption>
</figure>
</div>
<p>Remember that when you do this, you will need to re-normalized.</p>
<p>Now, we have access to new analyses. We will start with fold change analysis.</p>
<p>We can set what our fold change threshold is going to be, and what the direction of the comparison is.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/fold-change.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Fold change analysis between OH8243 and HATS</figcaption>
</figure>
</div>
<p>We can then click on any of the points to see how the relative intensity of that features is different among our groups.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/474.3577933_6.587835_fc.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Relative intensity of 474.3577_6.5878 between our two tomato groups</figcaption>
</figure>
</div>
<p>You can also click on the spreadsheet icon to view and/or download the full set of mean fold changes for each feature between the groups.</p>
</section>
<section id="t-test" class="level2" data-number="5.12">
<h2 data-number="5.12" class="anchored" data-anchor-id="t-test"><span class="header-section-number">5.12</span> T-test</h2>
<p>Like we did with an ANOVA for &gt; 2 groups, we might want to see if there are any differences in the intensity of each feature between our two tomato groups. We can do that using t-tests (parametric) or Wilcoxon rank-sum tests. We can select whether we have equal variance between or groups, whether we want to use a non-parametric test (if data is non-normal), what our p-value threshold is, and whether we are doing a multiple testing correct (you should be!).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/t-test-all-features.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A visualization of a FDR corrected t-test between OH8243 and HATS</figcaption>
</figure>
</div>
<p>You again can click on the spreadhseet icon to download the full feature set along with p-values, FDR adjusted p-values, and -log10 p-values.</p>
</section>
<section id="volcano-plots" class="level2" data-number="5.13">
<h2 data-number="5.13" class="anchored" data-anchor-id="volcano-plots"><span class="header-section-number">5.13</span> Volcano plots</h2>
<p>Volcano plots are nice as they incorporate both those features that are significantly different between groups, and the fold chance of that differences.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/04/volcano.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">A volcano plot incorporating both significance and fold change</figcaption>
</figure>
</div>
<p>If you click on any feature, you can see the relative intensity across our two groups.</p>
</section>
</section>
<section id="concluding-thoughts" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Concluding thoughts</h1>
<p>MetaboAnalyst is a really powerful tool for metabolomic analysis. Without knowing how to code, you can analyze your data in lots of interesting and useful ways, quickly. However you might find yourself wanting to do analysis that isn’t a part of the MetaboAnalyst suite of tools, or needing to export data for some other special analysis. I’ve included here some <a href="https://cooperstonelab.github.io/ufrgs-metab/activities/05_R.html">general code that my group uses for doing first pass metabolomics filtering and analysis in R</a> - feel free to use it as it makes sense for your work.</p>
</section>
<section id="references" class="level1" data-number="7">




</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">7 References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-ewald2024" class="csl-entry" role="listitem">
Ewald, Jessica D., Guangyan Zhou, Yao Lu, Jelena Kolic, Cara Ellis, James D. Johnson, Patrick E. Macdonald, and Jianguo Xia. 2024. <span>“Web-Based Multi-Omics Integration Using the Analyst Software Suite.”</span> <em>Nature Protocols</em>, February. <a href="https://doi.org/10.1038/s41596-023-00950-4">https://doi.org/10.1038/s41596-023-00950-4</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Created with RStudio and <a href="https://quarto.org/">Quarto</a> <br> © Jessica Cooperstone, 2024, License: <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a> <br> <a href="https://osu-codeclub.github.io/#category=website">Want to make a website like this one?</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Thanks to <a href="https://www.gov.br/capes/pt-br/acesso-a-informacao/acoes-e-programas/bolsas/bolsas-e-auxilios-internacionais/informacoes-internacionais/programa-institucional-de-internacionalizacao-capes-print">CAPES PrInt</a> for supporting this workshop 🙏</div>
  </div>
</footer>



</body></html>